<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filecoin Storage Provider Business Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; background: #f3f4f6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        const { useState, useEffect, createElement: h } = React;

        function FilecoinBusinessPlan() {
          const [storageCapacity, setStorageCapacity] = useState(10);
          const [powerCost, setPowerCost] = useState(0.065);
          const [datacapMultiplier, setDatacapMultiplier] = useState(10);
          const [hardwareType, setHardwareType] = useState('premium');
          const [blockReward, setBlockReward] = useState(0.0035);
          const [pledgePerSector, setPledgePerSector] = useState(0.07);
          const [dailyGasCost, setDailyGasCost] = useState(5);
          const [sectorDuration, setSectorDuration] = useState(12);
          const [configTab, setConfigTab] = useState('technical');
          const [downPaymentPct, setDownPaymentPct] = useState(20);
          const [interestRatePct, setInterestRatePct] = useState(7);
          const [loanTermMonths, setLoanTermMonths] = useState(36);
          const [projectionMonths, setProjectionMonths] = useState(60);
          const [exchangeRate, setExchangeRate] = useState(1.38);
          const [filPrice, setFilPrice] = useState(5.5);
          const [filPriceLoading, setFilPriceLoading] = useState(true);
          const [lastUpdated, setLastUpdated] = useState('');

          // Fetch real-time FIL price
          useEffect(() => {
            fetch('https://api.coingecko.com/api/v3/simple/price?ids=filecoin&vs_currencies=usd')
              .then(res => res.json())
              .then(data => {
                if (data.filecoin && data.filecoin.usd) {
                  setFilPrice(data.filecoin.usd);
                  setLastUpdated(new Date().toLocaleString());
                }
                setFilPriceLoading(false);
              })
              .catch(err => {
                console.error('Failed to fetch FIL price:', err);
                setFilPriceLoading(false);
              });
          }, []);

          // Hardware configurations
          const hardwareConfigs = {
            enterprise: {
              name: 'Enterprise (Datacenter Grade)',
              label: 'Enterprise',
              storagePerServer: 0.6,
              costPerServer: 65000,
              powerPerServer: 2.0,
              spacePerServer: 4,
              maintenancePerServer: 75,
              description: 'AMD EPYC 9004 (Genoa), enterprise U.2 NVMe, ECC RAM, redundant PSU ‚Äî maximum density & efficiency'
            },
            premium: {
              name: 'Premium (Current Gen)',
              label: 'Premium',
              storagePerServer: 0.5,
              costPerServer: 45000,
              powerPerServer: 2.5,
              spacePerServer: 4,
              maintenancePerServer: 100,
              description: 'AMD EPYC 7003 (Milan), enterprise NVMe SSDs ‚Äî proven reliability, strong performance/cost ratio'
            },
            refurbished: {
              name: 'Mid-Range (Refurbished)',
              label: 'Mid-Range',
              storagePerServer: 0.35,
              costPerServer: 25000,
              powerPerServer: 3.0,
              spacePerServer: 4,
              maintenancePerServer: 135,
              description: 'Refurbished EPYC 7002 (Rome) / Xeon 3rd Gen, mix of enterprise & consumer NVMe, 1-year warranty typical'
            },
            budget: {
              name: 'Budget (DIY / Legacy)',
              label: 'Budget',
              storagePerServer: 0.25,
              costPerServer: 15000,
              powerPerServer: 3.5,
              spacePerServer: 4,
              maintenancePerServer: 175,
              description: 'Older Ryzen Threadripper / Xeon E5 v4, consumer SATA + NVMe, higher failure rate, 2-3 year lifespan'
            }
          };

          const hardwareKeys = Object.keys(hardwareConfigs);

          const hardware = hardwareConfigs[hardwareType];

          // FIL price in CAD (needed for pledge and gas calculations)
          const filPriceCad = filPrice * exchangeRate;

          // Pledge collateral calculation
          // Source: https://docs.filecoin.io/storage-providers/filecoin-economics/fil-collateral
          // Initial pledge = storage pledge + consensus pledge, locked per sector
          const sectorsPerTiB = 32; // 1 TiB = 32 sectors of 32 GiB
          const totalSectors = storageCapacity * 1024 * sectorsPerTiB;
          const totalPledgeFil = totalSectors * pledgePerSector;
          const totalPledgeCad = totalPledgeFil * filPriceCad;

          // Gas costs (monthly, in CAD)
          // Source: https://docs.filecoin.io/storage-providers/filecoin-economics/block-rewards
          // Covers WindowPoSt, sector commits, and other on-chain messages
          const monthlyGasCost = dailyGasCost * 30 * filPriceCad;

          // Hardware assumptions
          const serversNeeded = Math.ceil(storageCapacity / hardware.storagePerServer);
          const costPerServer = hardware.costPerServer;
          const totalHardwareCost = serversNeeded * costPerServer;

          // Financing assumptions (from configurable state)
          const downPayment = downPaymentPct / 100;
          const loanTerm = loanTermMonths;
          const interestRate = interestRatePct / 100;
          const monthlyRate = interestRate / 12;
          const loanAmount = totalHardwareCost * (1 - downPayment);
          const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, loanTerm)) / (Math.pow(1 + monthlyRate, loanTerm) - 1);

          // Operational costs
          const powerPerServer = hardware.powerPerServer;
          const totalPowerKw = powerPerServer * serversNeeded;
          const monthlyPowerCost = totalPowerKw * 24 * 30 * powerCost;

          const spacePerServer = hardware.spacePerServer;
          const rackSpaceNeeded = Math.ceil(serversNeeded * spacePerServer / 42);
          const costPerRackSpace = 350;
          const monthlySpaceCost = rackSpaceNeeded * costPerRackSpace;

          const monthlyBandwidth = 500;
          const monthlyMaintenance = serversNeeded * hardware.maintenancePerServer;
          const monthlyInsurance = 400;
          const monthlySalary = 6500;

          const totalMonthlyOpex = monthlyPowerCost + monthlySpaceCost + monthlyBandwidth +
                                   monthlyMaintenance + monthlyInsurance + monthlySalary + monthlyGasCost;

          // Revenue assumptions
          // Source: https://filfox.info/en (24h average mining reward as of Feb 2026)
          const baseBlockReward = blockReward;
          const datacapBonus = baseBlockReward * datacapMultiplier;
          const totalRewardRate = baseBlockReward + datacapBonus;

          const dailyRevenue = storageCapacity * 1024 * totalRewardRate * filPriceCad;
          const monthlyRevenue = dailyRevenue * 30;

          // Calculate projections
          const months = projectionMonths;
          let cumulativeCashFlow = -(totalHardwareCost * downPayment) - totalPledgeCad;
          let breakEvenMonth = null;

          for (let month = 1; month <= months; month++) {
            const isFinancing = month <= loanTerm;
            const monthlyCapex = isFinancing ? monthlyPayment : 0;
            const totalMonthlyCost = totalMonthlyOpex + monthlyCapex;
            const monthlyProfit = monthlyRevenue - totalMonthlyCost;
            cumulativeCashFlow += monthlyProfit;

            if (breakEvenMonth === null && cumulativeCashFlow > 0) {
              breakEvenMonth = month;
            }
          }

          const yearlyProfit = monthlyRevenue * 12 - (totalMonthlyOpex * 12) - (monthlyPayment * 12);
          const roi = (yearlyProfit / totalHardwareCost) * 100;

          return h('div', { className: 'w-full max-w-6xl mx-auto p-6 bg-white min-h-screen' },
            h('h1', { className: 'text-3xl font-bold mb-6 text-blue-900' }, 'Filecoin Storage Provider Business Plan'),
            h('p', { className: 'text-lg mb-6 text-gray-700' }, 'Quebec, Canada - Strategic Analysis & Financial Projections'),

            // Real-time FIL Price Banner
            h('div', { className: 'bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg mb-6' },
              h('div', { className: 'flex justify-between items-center' },
                h('div', {},
                  h('div', { className: 'text-sm opacity-90' }, 'üî¥ LIVE FIL Price'),
                  h('div', { className: 'text-3xl font-bold' },
                    filPriceLoading ? 'Loading...' : '$' + filPrice.toFixed(2) + ' USD'
                  ),
                  h('div', { className: 'text-sm opacity-75' },
                    lastUpdated ? 'Updated: ' + lastUpdated : 'Fetching from CoinGecko...'
                  )
                ),
                h('div', { className: 'text-right' },
                  h('div', { className: 'text-sm opacity-90' }, 'CAD Equivalent'),
                  h('div', { className: 'text-2xl font-bold' }, '$' + filPriceCad.toFixed(2) + ' CAD'),
                  h('div', { className: 'text-sm opacity-75' }, '(' + exchangeRate + ' USD/CAD)')
                )
              )
            ),

            // Configuration
            h('div', { className: 'bg-blue-50 p-6 rounded-lg mb-6' },
              h('div', { className: 'flex items-center justify-between mb-4' },
                h('h2', { className: 'text-xl font-bold' }, 'Configuration'),
                h('div', { className: 'flex bg-white rounded-lg border overflow-hidden' },
                  h('button', {
                    onClick: () => setConfigTab('technical'),
                    className: 'px-4 py-2 text-sm font-medium transition-colors ' +
                      (configTab === 'technical' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100')
                  }, 'Technical'),
                  h('button', {
                    onClick: () => setConfigTab('financial'),
                    className: 'px-4 py-2 text-sm font-medium transition-colors ' +
                      (configTab === 'financial' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100')
                  }, 'Financial')
                )
              ),

              // Technical tab
              configTab === 'technical' ? h('div', {},
                h('h3', { className: 'text-sm font-semibold text-blue-800 mb-2' }, 'Infrastructure'),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4' },
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Hardware Type'),
                    h('select', {
                      value: hardwareType,
                      onChange: (e) => setHardwareType(e.target.value),
                      className: 'w-full p-2 border rounded bg-white'
                    },
                      h('option', { value: 'enterprise' }, 'Enterprise (Datacenter)'),
                      h('option', { value: 'premium' }, 'Premium (Current Gen)'),
                      h('option', { value: 'refurbished' }, 'Mid-Range (Refurbished)'),
                      h('option', { value: 'budget' }, 'Budget (DIY / Legacy)')
                    )
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Storage Capacity (PiB)'),
                    h('input', {
                      type: 'number',
                      value: storageCapacity,
                      onChange: (e) => setStorageCapacity(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      min: 1,
                      max: 100
                    })
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Power Cost (CAD/kWh)'),
                    h('input', {
                      type: 'number',
                      value: powerCost,
                      onChange: (e) => setPowerCost(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.001,
                      min: 0.03,
                      max: 0.15
                    })
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Datacap Multiplier'),
                    h('input', {
                      type: 'number',
                      value: datacapMultiplier,
                      onChange: (e) => setDatacapMultiplier(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      min: 1,
                      max: 100
                    })
                  )
                ),
                // Filecoin Network Parameters
                h('h3', { className: 'text-sm font-semibold text-blue-800 mb-2 mt-4' }, 'Filecoin Network Parameters'),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4' },
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Block Reward (FIL/TiB/day)'),
                    h('input', {
                      type: 'number',
                      value: blockReward,
                      onChange: (e) => setBlockReward(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.0001,
                      min: 0,
                      max: 1
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'Source: filfox.info 24h avg')
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Pledge per Sector (FIL/32GiB)'),
                    h('input', {
                      type: 'number',
                      value: pledgePerSector,
                      onChange: (e) => setPledgePerSector(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.01,
                      min: 0,
                      max: 5
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'Initial pledge collateral locked')
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Gas Cost (FIL/day)'),
                    h('input', {
                      type: 'number',
                      value: dailyGasCost,
                      onChange: (e) => setDailyGasCost(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.5,
                      min: 0,
                      max: 50
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'WindowPoSt + sector commits')
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Sector Duration (months)'),
                    h('input', {
                      type: 'number',
                      value: sectorDuration,
                      onChange: (e) => setSectorDuration(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 1,
                      min: 6,
                      max: 60
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'Pledge lock-up period')
                  )
                ),
                // Hardware description
                h('div', { className: 'mt-4 p-3 bg-white rounded border border-blue-200' },
                  h('div', { className: 'font-bold text-sm text-blue-900' }, hardware.name),
                  h('div', { className: 'text-sm text-gray-600 mt-1' }, hardware.description),
                  h('div', { className: 'grid grid-cols-2 md:grid-cols-5 gap-2 mt-2 text-xs' },
                    h('div', {}, 'üíæ ' + hardware.storagePerServer + ' PiB/server'),
                    h('div', {}, 'üí∞ $' + hardware.costPerServer.toLocaleString() + '/server'),
                    h('div', {}, '‚ö° ' + hardware.powerPerServer + ' kW/server'),
                    h('div', {}, 'üîß $' + hardware.maintenancePerServer + '/mo maint.'),
                    h('div', {}, 'üì¶ ' + serversNeeded + ' servers needed')
                  )
                )
              ) : null,

              // Financial tab
              configTab === 'financial' ? h('div', {},
                h('h3', { className: 'text-sm font-semibold text-blue-800 mb-2' }, 'Financing'),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Down Payment (%)'),
                    h('input', {
                      type: 'number',
                      value: downPaymentPct,
                      onChange: (e) => setDownPaymentPct(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 5,
                      min: 0,
                      max: 100
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' },
                      'Upfront: $' + Math.round(totalHardwareCost * downPayment).toLocaleString() + ' CAD'
                    )
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Interest Rate (% APR)'),
                    h('input', {
                      type: 'number',
                      value: interestRatePct,
                      onChange: (e) => setInterestRatePct(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.5,
                      min: 0,
                      max: 25
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'Annual percentage rate on loan')
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Loan Term (months)'),
                    h('input', {
                      type: 'number',
                      value: loanTermMonths,
                      onChange: (e) => setLoanTermMonths(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 6,
                      min: 6,
                      max: 84
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' },
                      'Payment: $' + Math.round(monthlyPayment).toLocaleString() + '/mo'
                    )
                  )
                ),
                h('h3', { className: 'text-sm font-semibold text-blue-800 mb-2 mt-4' }, 'Projection & Currency'),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'Projection Period (months)'),
                    h('input', {
                      type: 'number',
                      value: projectionMonths,
                      onChange: (e) => setProjectionMonths(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 6,
                      min: 12,
                      max: 120
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, 'Cash flow analysis window')
                  ),
                  h('div', {},
                    h('label', { className: 'block text-sm font-medium mb-2' }, 'USD/CAD Exchange Rate'),
                    h('input', {
                      type: 'number',
                      value: exchangeRate,
                      onChange: (e) => setExchangeRate(Number(e.target.value)),
                      className: 'w-full p-2 border rounded',
                      step: 0.01,
                      min: 1.0,
                      max: 2.0
                    }),
                    h('div', { className: 'text-xs text-gray-500 mt-1' }, '1 USD = ' + exchangeRate + ' CAD')
                  )
                ),
                // Financial summary card
                h('div', { className: 'mt-4 p-3 bg-white rounded border border-blue-200' },
                  h('div', { className: 'font-bold text-sm text-blue-900 mb-2' }, 'Financing Summary'),
                  h('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3 text-xs' },
                    h('div', {},
                      h('div', { className: 'text-gray-500' }, 'Hardware Cost'),
                      h('div', { className: 'font-bold' }, '$' + totalHardwareCost.toLocaleString())
                    ),
                    h('div', {},
                      h('div', { className: 'text-gray-500' }, 'Down Payment'),
                      h('div', { className: 'font-bold' }, '$' + Math.round(totalHardwareCost * downPayment).toLocaleString() + ' (' + downPaymentPct + '%)')
                    ),
                    h('div', {},
                      h('div', { className: 'text-gray-500' }, 'Financed'),
                      h('div', { className: 'font-bold' }, '$' + Math.round(loanAmount).toLocaleString() + ' @ ' + interestRatePct + '%')
                    ),
                    h('div', {},
                      h('div', { className: 'text-gray-500' }, 'Monthly Payment'),
                      h('div', { className: 'font-bold text-blue-700' }, '$' + Math.round(monthlyPayment).toLocaleString() + '/mo √ó ' + loanTermMonths + ' mo')
                    )
                  )
                )
              ) : null
            ),

            // Executive Summary
            h('div', { className: 'mb-8' },
              h('h2', { className: 'text-2xl font-bold mb-4 text-blue-900' }, 'Executive Summary'),
              h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                h('div', { className: 'bg-green-50 p-4 rounded-lg' },
                  h('div', { className: 'text-sm text-gray-600' }, 'Initial Capital Required'),
                  h('div', { className: 'text-2xl font-bold text-green-700' },
                    '$' + Math.round(totalHardwareCost * downPayment + totalPledgeCad).toLocaleString() + ' CAD'
                  ),
                  h('div', { className: 'text-xs text-gray-500' },
                    downPaymentPct + '% down ($' + Math.round(totalHardwareCost * downPayment).toLocaleString() + ') + pledge ($' + Math.round(totalPledgeCad).toLocaleString() + ')'
                  )
                ),
                h('div', { className: 'bg-blue-50 p-4 rounded-lg' },
                  h('div', { className: 'text-sm text-gray-600' }, 'Monthly Revenue (Steady State)'),
                  h('div', { className: 'text-2xl font-bold text-blue-700' },
                    '$' + Math.round(monthlyRevenue).toLocaleString() + ' CAD'
                  ),
                  h('div', { className: 'text-xs text-gray-500' }, 'With Datacap ' + datacapMultiplier + 'x multiplier')
                ),
                h('div', { className: 'bg-orange-50 p-4 rounded-lg' },
                  h('div', { className: 'text-sm text-gray-600' }, 'Break-Even Point'),
                  h('div', { className: 'text-2xl font-bold ' + (breakEvenMonth ? 'text-orange-700' : 'text-red-600') },
                    breakEvenMonth ? breakEvenMonth + ' months' : '>' + projectionMonths + ' months'
                  ),
                  h('div', { className: 'text-xs text-gray-500' },
                    breakEvenMonth
                      ? 'Cumulative cash flow positive'
                      : 'Not reached within ' + projectionMonths + '-month window ‚Äî adjust Financial tab'
                  )
                ),
                h('div', { className: 'bg-purple-50 p-4 rounded-lg' },
                  h('div', { className: 'text-sm text-gray-600' }, 'Annual ROI (Year 1)'),
                  h('div', { className: 'text-2xl font-bold text-purple-700' },
                    roi.toFixed(1) + '%'
                  ),
                  h('div', { className: 'text-xs text-gray-500' }, 'Based on hardware investment')
                )
              )
            ),

            // Hardware Comparison
            h('div', { className: 'mb-8' },
              h('h2', { className: 'text-2xl font-bold mb-4 text-blue-900' }, 'Hardware Scenario Comparison'),
              h('div', { className: 'bg-gray-50 p-4 rounded-lg overflow-x-auto' },
                h('table', { className: 'w-full text-sm' },
                  h('thead', {},
                    h('tr', { className: 'border-b' },
                      h('th', { className: 'text-left py-2' }, 'Metric'),
                      hardwareKeys.map(function(key) {
                        return h('th', {
                          key: key,
                          className: 'text-right py-2 px-2 ' + (key === hardwareType ? 'bg-blue-100 font-bold' : 'bg-gray-50')
                        }, hardwareConfigs[key].label + (key === hardwareType ? ' ‚úì' : ''))
                      })
                    )
                  ),
                  h('tbody', {},
                    // Storage per server
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Storage / Server'),
                      hardwareKeys.map(function(key) {
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 font-bold' : '')
                        }, hardwareConfigs[key].storagePerServer + ' PiB')
                      })
                    ),
                    // Cost per server
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Cost / Server'),
                      hardwareKeys.map(function(key) {
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 font-bold' : '')
                        }, '$' + hardwareConfigs[key].costPerServer.toLocaleString())
                      })
                    ),
                    // Power per server
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Power / Server'),
                      hardwareKeys.map(function(key) {
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 font-bold' : '')
                        }, hardwareConfigs[key].powerPerServer + ' kW')
                      })
                    ),
                    // Maintenance per server
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Maintenance / Server'),
                      hardwareKeys.map(function(key) {
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 font-bold' : '')
                        }, '$' + hardwareConfigs[key].maintenancePerServer + '/mo')
                      })
                    ),
                    // Servers needed
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Servers (' + storageCapacity + ' PiB)'),
                      hardwareKeys.map(function(key) {
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 font-bold' : '')
                        }, Math.ceil(storageCapacity / hardwareConfigs[key].storagePerServer))
                      })
                    ),
                    // Total hardware cost
                    h('tr', { className: 'border-b font-bold' },
                      h('td', { className: 'py-2' }, 'Total Hardware Cost'),
                      hardwareKeys.map(function(key) {
                        var servers = Math.ceil(storageCapacity / hardwareConfigs[key].storagePerServer);
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 text-blue-700' : '')
                        }, '$' + (servers * hardwareConfigs[key].costPerServer).toLocaleString())
                      })
                    ),
                    // Monthly power cost
                    h('tr', { className: 'font-bold' },
                      h('td', { className: 'py-2' }, 'Monthly Power'),
                      hardwareKeys.map(function(key) {
                        var servers = Math.ceil(storageCapacity / hardwareConfigs[key].storagePerServer);
                        return h('td', {
                          key: key,
                          className: 'text-right px-2 ' + (key === hardwareType ? 'bg-blue-50 text-red-700' : '')
                        }, '$' + Math.round(servers * hardwareConfigs[key].powerPerServer * 24 * 30 * powerCost).toLocaleString())
                      })
                    )
                  )
                )
              )
            ),

            // Capital Expenditure
            h('div', { className: 'mb-8' },
              h('h2', { className: 'text-2xl font-bold mb-4 text-blue-900' }, 'Capital Expenditure'),
              h('div', { className: 'bg-gray-50 p-4 rounded-lg overflow-x-auto' },
                h('table', { className: 'w-full text-sm' },
                  h('thead', {},
                    h('tr', { className: 'border-b' },
                      h('th', { className: 'text-left py-2' }, 'Item'),
                      h('th', { className: 'text-right py-2' }, 'Quantity'),
                      h('th', { className: 'text-right py-2' }, 'Unit Cost (CAD)'),
                      h('th', { className: 'text-right py-2' }, 'Total (CAD)')
                    )
                  ),
                  h('tbody', {},
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, hardware.name),
                      h('td', { className: 'text-right' }, serversNeeded),
                      h('td', { className: 'text-right' }, '$' + costPerServer.toLocaleString()),
                      h('td', { className: 'text-right font-bold' }, '$' + totalHardwareCost.toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Pledge Collateral (locked)'),
                      h('td', { className: 'text-right' }, Math.round(totalPledgeFil).toLocaleString() + ' FIL'),
                      h('td', { className: 'text-right' }, pledgePerSector + ' FIL/sector √ó ' + totalSectors.toLocaleString() + ' sectors'),
                      h('td', { className: 'text-right font-bold text-orange-600' },
                        '$' + Math.round(totalPledgeCad).toLocaleString()
                      )
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Down Payment (' + downPaymentPct + '%)'),
                      h('td', { className: 'text-right' }, '-'),
                      h('td', { className: 'text-right' }, '-'),
                      h('td', { className: 'text-right font-bold text-red-600' },
                        '$(' + Math.round(totalHardwareCost * downPayment).toLocaleString() + ')'
                      )
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Financed Amount'),
                      h('td', { className: 'text-right' }, loanTermMonths + ' months'),
                      h('td', { className: 'text-right' }, interestRatePct + '% APR'),
                      h('td', { className: 'text-right font-bold' }, '$' + Math.round(loanAmount).toLocaleString())
                    ),
                    h('tr', {},
                      h('td', { className: 'py-2 font-bold' }, 'Monthly Loan Payment'),
                      h('td', { className: 'text-right' }, '-'),
                      h('td', { className: 'text-right' }, '-'),
                      h('td', { className: 'text-right font-bold text-blue-700' },
                        '$' + Math.round(monthlyPayment).toLocaleString() + '/mo'
                      )
                    )
                  )
                )
              )
            ),

            // Monthly Operating Expenses
            h('div', { className: 'mb-8' },
              h('h2', { className: 'text-2xl font-bold mb-4 text-blue-900' }, 'Monthly Operating Expenses'),
              h('div', { className: 'bg-gray-50 p-4 rounded-lg overflow-x-auto' },
                h('table', { className: 'w-full text-sm' },
                  h('thead', {},
                    h('tr', { className: 'border-b' },
                      h('th', { className: 'text-left py-2' }, 'Expense Category'),
                      h('th', { className: 'text-right py-2' }, 'Details'),
                      h('th', { className: 'text-right py-2' }, 'Monthly Cost (CAD)')
                    )
                  ),
                  h('tbody', {},
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Electricity'),
                      h('td', { className: 'text-right' }, totalPowerKw.toFixed(1) + ' kW √ó $' + powerCost + '/kWh'),
                      h('td', { className: 'text-right' }, '$' + Math.round(monthlyPowerCost).toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Datacenter Space'),
                      h('td', { className: 'text-right' }, rackSpaceNeeded + ' racks √ó $350/rack'),
                      h('td', { className: 'text-right' }, '$' + Math.round(monthlySpaceCost).toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Bandwidth'),
                      h('td', { className: 'text-right' }, '10Gbps unmetered'),
                      h('td', { className: 'text-right' }, '$' + monthlyBandwidth.toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Maintenance & Spares'),
                      h('td', { className: 'text-right' }, serversNeeded + ' servers √ó $' + hardware.maintenancePerServer),
                      h('td', { className: 'text-right' }, '$' + Math.round(monthlyMaintenance).toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Insurance'),
                      h('td', { className: 'text-right' }, 'Equipment & liability'),
                      h('td', { className: 'text-right' }, '$' + monthlyInsurance.toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'Personnel'),
                      h('td', { className: 'text-right' }, '1 FTE operator/admin'),
                      h('td', { className: 'text-right' }, '$' + monthlySalary.toLocaleString())
                    ),
                    h('tr', { className: 'border-b' },
                      h('td', { className: 'py-2' }, 'On-Chain Gas Fees'),
                      h('td', { className: 'text-right' }, dailyGasCost + ' FIL/day √ó $' + filPriceCad.toFixed(2) + ' CAD'),
                      h('td', { className: 'text-right' }, '$' + Math.round(monthlyGasCost).toLocaleString())
                    ),
                    h('tr', { className: 'font-bold' },
                      h('td', { className: 'py-2' }, 'Total Monthly OPEX'),
                      h('td', { className: 'text-right' }, '-'),
                      h('td', { className: 'text-right text-red-600' }, '$' + Math.round(totalMonthlyOpex).toLocaleString())
                    )
                  )
                )
              )
            ),

            // Revenue Model
            h('div', { className: 'mb-8' },
              h('h2', { className: 'text-2xl font-bold mb-4 text-blue-900' }, 'Revenue Model (with Datacap)'),
              h('div', { className: 'bg-green-50 p-4 rounded-lg mb-4' },
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4 text-sm' },
                  h('div', {},
                    h('div', { className: 'text-gray-600' }, 'Base Block Rewards'),
                    h('div', { className: 'text-lg' }, baseBlockReward + ' FIL/TiB/day')
                  ),
                  h('div', {},
                    h('div', { className: 'text-gray-600' }, 'Datacap Bonus (' + datacapMultiplier + 'x)'),
                    h('div', { className: 'text-lg' }, datacapBonus.toFixed(2) + ' FIL/TiB/day')
                  ),
                  h('div', {},
                    h('div', { className: 'text-gray-600' }, 'Total Rewards Rate'),
                    h('div', { className: 'text-lg font-bold' }, totalRewardRate.toFixed(2) + ' FIL/TiB/day')
                  ),
                  h('div', {},
                    h('div', { className: 'text-gray-600' }, 'Live FIL Price'),
                    h('div', { className: 'text-lg font-bold text-green-700' }, '$' + filPrice.toFixed(2) + ' USD ($' + filPriceCad.toFixed(2) + ' CAD)')
                  )
                )
              ),
              h('div', { className: 'bg-gray-50 p-4 rounded-lg' },
                h('div', { className: 'text-sm text-gray-600 mb-2' }, 'Monthly Revenue Calculation'),
                h('div', { className: 'text-base' },
                  storageCapacity + ' PiB √ó 1,024 TiB/PiB √ó ' + totalRewardRate.toFixed(2) +
                  ' FIL/TiB/day √ó 30 days √ó $' + filPriceCad.toFixed(2) + ' CAD/FIL'
                ),
                h('div', { className: 'text-2xl font-bold text-green-700 mt-2' },
                  '= $' + Math.round(monthlyRevenue).toLocaleString() + ' CAD/month'
                )
              )
            ),

            // Key Metrics Summary
            h('div', { className: 'bg-gray-100 p-6 rounded-lg mb-8' },
              h('h2', { className: 'text-xl font-bold mb-3' }, 'Key Financial Metrics'),
              h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4 text-sm' },
                h('div', {},
                  h('div', { className: 'font-bold mb-2' }, 'Monthly Cash Flow'),
                  h('div', {}, 'Revenue: $' + Math.round(monthlyRevenue).toLocaleString()),
                  h('div', {}, 'OPEX: $' + Math.round(totalMonthlyOpex).toLocaleString()),
                  h('div', {}, 'Loan Payment: $' + Math.round(monthlyPayment).toLocaleString()),
                  h('div', { className: 'font-bold text-green-700 mt-2' },
                    'Net Profit: $' + Math.round(monthlyRevenue - totalMonthlyOpex - monthlyPayment).toLocaleString()
                  )
                ),
                h('div', {},
                  h('div', { className: 'font-bold mb-2' }, 'Annual Projections'),
                  h('div', {}, 'Annual Revenue: $' + Math.round(monthlyRevenue * 12).toLocaleString()),
                  h('div', {}, 'Annual OPEX: $' + Math.round(totalMonthlyOpex * 12).toLocaleString()),
                  h('div', { className: 'font-bold text-green-700 mt-2' },
                    'Annual Profit: $' + Math.round(yearlyProfit).toLocaleString()
                  )
                ),
                h('div', {},
                  h('div', { className: 'font-bold mb-2' }, 'Investment Returns'),
                  h('div', {}, 'Total Investment: $' + totalHardwareCost.toLocaleString()),
                  h('div', {}, 'Down Payment: $' + Math.round(totalHardwareCost * downPayment).toLocaleString()),
                  h('div', {}, 'Pledge Collateral: $' + Math.round(totalPledgeCad).toLocaleString() + ' (' + Math.round(totalPledgeFil).toLocaleString() + ' FIL)'),
                  h('div', {}, 'Break-even: ' + (breakEvenMonth ? breakEvenMonth + ' months' : '>' + projectionMonths + ' mo')),
                  h('div', { className: 'font-bold text-green-700 mt-2' }, 'ROI: ' + roi.toFixed(1) + '%')
                )
              )
            ),

            // Key Assumptions
            h('div', { className: 'bg-blue-50 p-6 rounded-lg' },
              h('h2', { className: 'text-xl font-bold mb-3' }, 'Key Assumptions'),
              h('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4 text-sm' },
                h('ul', { className: 'space-y-1' },
                  h('li', { className: 'font-bold text-blue-800' }, 'Market & Financing'),
                  h('li', {}, '‚Ä¢ FIL price: $' + filPrice.toFixed(2) + ' USD (LIVE from CoinGecko)'),
                  h('li', {}, '‚Ä¢ USD/CAD: ' + exchangeRate),
                  h('li', {}, '‚Ä¢ Hardware: ' + hardware.name),
                  h('li', {}, '‚Ä¢ Quebec power: $' + powerCost + '/kWh'),
                  h('li', {}, '‚Ä¢ ' + downPaymentPct + '% down, ' + interestRatePct + '% APR, ' + loanTermMonths + ' mo term')
                ),
                h('ul', { className: 'space-y-1' },
                  h('li', { className: 'font-bold text-blue-800' }, 'Filecoin Network'),
                  h('li', {}, '‚Ä¢ Block reward: ' + blockReward + ' FIL/TiB/day'),
                  h('li', {}, '‚Ä¢ Datacap multiplier: ' + datacapMultiplier + 'x'),
                  h('li', {}, '‚Ä¢ Pledge: ' + pledgePerSector + ' FIL/sector'),
                  h('li', {}, '‚Ä¢ Gas cost: ' + dailyGasCost + ' FIL/day'),
                  h('li', {}, '‚Ä¢ Sector duration: ' + sectorDuration + ' months')
                ),
                h('ul', { className: 'space-y-1' },
                  h('li', { className: 'font-bold text-blue-800' }, 'Operational'),
                  h('li', {}, '‚Ä¢ 95% uptime/quality score'),
                  h('li', {}, '‚Ä¢ No slashing penalties assumed'),
                  h('li', {}, '‚Ä¢ Steady state reached month 3'),
                  h('li', {}, '‚Ä¢ No regulatory changes'),
                  h('li', {}, '‚Ä¢ 75% block reward vests over 180 days')
                )
              )
            )
          );
        }

        // Render the app
        try {
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(FilecoinBusinessPlan));
          console.log('‚úÖ App loaded successfully!');
        } catch (error) {
          console.error('‚ùå Error:', error);
          document.getElementById('root').innerHTML = '<div style="padding: 2rem; color: red;">Error loading app. Check console.</div>';
        }
    </script>
</body>
</html>